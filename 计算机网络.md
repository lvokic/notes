# 计算机网络

## 第一章-因特网概述

1.计算机网络组成：

> 终端：客户机，服务器
>
> 通信链路：光纤，双绞线，无线电，同轴电缆，电话线
>
> 设备：路由器，二层交换机

2.网络应用：

> 仅运行在终端系统上，不运行在网络核心的分组交换机中，因特网是为应用程序提供服务的基础设施。

3.网络协议：

> 定义了在两个或多个通信实体之间交换的报文格式和次序，以及报文发送（和/或）接收一条报文或其他事件所采取的动作。协议三要素：语法、语义、时序(同 步)。
>
> - (1) 语法：即数据与控制信息的结构或格式（IP 头部、TCP 头部的字段含义）； 
> - (2) 语义：即需要发出何种控制信息，完成何种动作以及做出何种响应；
> - (3) 时序（同步），即事件实现顺序的详细说明。

4.网络的构建形式：分组交换网络和电路交换网络

> - 分组交换网络：
>   - 主机将应用层消息(messages)分割为若干分组(packets），每个分组沿着从源主机到目的主机的传输路径通过每个路由器（逐跳）转发，每个分组在每条链路传输时，以链路的最大传输速率传输。每个路由器采用存储转发机制，即将每个分组完整接收后，根据其 IP 头部包含的目的 IP 地址进行转发。
>   - 排队和丢包：
>     - 如果在一段时间内，分组到达链路速率超过了链路的传输速率：
>     - 分组将排队，在输出链路上等待传输； 
>     - 如果缓存溢出，则会出现丢包
> - 电路交换网络：
>   - 数据的发送方和接收方之间需要建立一条物理的电路，发送方可以以恒定的速率向接收方发送数据，整条电路被临时占用，直到数据发送结束。 电路交换中的几种复用技术：频分复用（FDM）、时分复用（TDM）。
> - 区别：
>   - 报文交换（存储转发，不预留资源，整个报文不分割为分组）。
>   - 电路交换浪费资源（静默期）

5.分组网络中的四种时延：

> - 处理时延：检测比特错误，确定输出链路
>
> - 排队时延：在输出端口的等待时间，依赖于路由器拥塞等级
>
> - ![截屏2023-06-24 10.21.26](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 10.21.26.png)
>   - 传输时延大于传播时延时，一个分组中的前几个比特已到达下一路由器，而余下的仍然在前面的路由器中等待传输。

6.traceroute 诊断程序：可追踪源和目的之间经过的路由

> ![截屏2023-06-24 10.36.37](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 10.36.37.png)
>
> ![截屏2023-06-24 10.36.53](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 10.36.53.png)

7.协议层次及服务模型:

> TCP五层结构：
>
> - 应用层：支持网络应用，各种网络应用（QQ、腾讯视频、FTP、Web、SMTP、DNS、DHCP）
> - 运输层：实现（进程-进程）的数据传输，TCP、UDP
> - 网络层：实现（主机-主机）的数据传输，IP、RIP、OSPF、BGP、ICMP、ARP（2.5 层）
> - 链路层：实现单条链路的数据传输，802.11、802.1、802.3
> - 物理层：实现单条链路上比特流的编码和解码。
>
> OSI七层体系结构：
>
> - 表示层：加解密、数据压缩、格式转换 
> - 会话层：对数据传输进行管理，包括数据交换的定界、同步，建立检查点等。
> -  采用分层协议的原因； 使复杂系统简化：将一个大而复杂系统划分为若干个明确、特定的部分，分别讨论研究。 易于维护、系统的更新：某层功能变化，不会影响系统其余部分。
> -  分层的缺点；有些功能可能在不同层重复出现：如基于链路和基于端到端传输的差错恢 复；某层的功能可能需要仅存在其他某层的信息。

8.数据的封装和解封装：加（拿掉）头部

> - 应用层：报文（message）
> - 运输层：报文段（segment） 
> - 网络层：数据报（分组）packet（datagram） 
> - 数据链路层：数据帧（frame）
> -  物理层：比特流（bit）
> -  主机上：全部层次，路由器上运行物理层、数据链路层、网络层，交换机上运行物理层、 数据链路层。

9.网络安全问题：

> - （1）恶意软件对主机的侵害：恶意代码(Malware)植入主机，包括病毒和蠕虫；也可以 是间谍软件，记录你的键盘敲击、访问网站等信息，上传到指定网站；也可以将你的主 机在僵尸网络中注册，参与分布式攻击等。 
> - （2）恶意软件对网络基础设施的侵害：DoS 攻击和 DDoS 攻击，攻击路由器、服务器 等，使其不能为正常用户服务。
> - （3）在网络上嗅探(sniffer)：在共享（广播）信道中，可以监听到别人的数据包；
> - （4）IP 哄骗：发送的数据包的 IP 地址等信息伪装成其他人的。
> - 主动攻击：包含攻击者访问他所需信息的故意行为。比如远程登录到指定机器的端 口 25 找出公司运行的邮件服务器的信息；伪造无效 IP 地址去连接服务器，使接受 到错误 IP 地址的系统浪费时间去连接哪个非法地址。攻击者是在主动地做一些不 利于你或你的公司系统的事情。正因为如此，如果要寻找他们是很容易发现的。主 动攻击包括拒绝服务攻击、信息篡改、资源使用、欺骗等攻击方法。
> -  被动攻击主要是收集信息而不是进行访问，数据的合法用户对这种活动一点也不会 觉察到。被动攻击包括嗅探、信息收集等攻击方法。（不会影响受害人的设备）

## 第一章练习题

> ![截屏2023-06-24 12.52.46](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 12.52.46.png)

```
1. 源和目的端之间单独使用一条距离是10m的物理链路连接：
- 传输时延 = 数据大小 / 传输速率 = 40Mbit / 10Mbps = 4秒
- 传播时延 = 距离 / 传播速率 = 10 * 7m / 2x10^8 m/s = 0.05秒
- 端到端时延 = 传输时延 + 传播时延 = 4秒 + 0.05秒（可以忽略传播时延）

2. 源和目的端之间单独使用一条距离是10^7m的物理链路连接：
- 传输时延 = 数据大小 / (传输速率 / 时隙数) = 40Mbit / (10Mbps / 10) = 40秒
- 传播时延 = 距离 / 传播速率 = 10^7m / 2x10^8 m/s = 0.05秒
- 端到端时延 = 传输时延 + 传播时延 = 40秒 + 0.05秒 = 40.05秒

3. 路径是由一台路由器连接的2条链路所组成，每条链路长度为5x10^6m：
- 每条链路的传输时延 = 数据大小 / 传输速率 = 40Mbit / 10Mbps = 4秒
- 每条链路的传播时延 = 距离 / 传播速率 = 5x10^6m / 2x10^8 m/s = 0.025秒
- 端到端时延 = 2 * (传输时延 + 传播时延) = 2 * (4秒 + 0.025秒) = 8.05秒

4. 路径是由一台路由器连接的2条链路所组成，每条链路长度为5x10^6m，文档分为4个分组：
- 每个分组的传输时延 = 分组数据大小 / 传输速率 = 10Mbit / 10Mbps = 1秒
- 每个分组的传播时延 = 距离 / 传播速率 = 5x10^6m / 2x10^8 m/s = 0.025秒
- 端到端时延 = (4-1) * 传输时延 + 传输时延 + 2 * 传播时延 = 3秒 + 1秒 + 2 * 0.025秒 = 4.05秒

在协议分层服务模型中，服务的定义应该是C，即各层通过其SAP向上层提供的一组功能。

当一台计算机从FTP服务器下载文件时，在该FTP服务器上对数据进行封装的五个转换步骤应该是B，即报文、报文段、数据报、帧、比特。

因特网协议栈分为四个层次，自顶向下分别是：应用层，运输层，网络层，链路层。应用层是最接近用户的层，提供用户所需的各种服务；运输层负责端到端的通信；网络层负责数据包的转发和路由选择；链路层负责网络中各个节点的通信。

```

## 第二章-应用层

1、网络应用程序的体系结构：C/S、P2P：

> Client-Server:
>
> - 服务器(server):
>   - 保持开机状态
>   - 固定的IP地址
>   - 可以采用具有扩展性的数据中心
> - 客户端(client):
>   -  主动与服务器进行通信
>   -  可以间断性连接
>   -  可以采用动态IP地址
>   -  客户端进程之间相互不同通信
>
> P2P:
>
> - 服务器不需要总是开机状态
> - 任意的终端系统之间可以直接通信
> - 对等节点从其他对等节点请求服务，同时
>   可以为其他对等节点提供服务
>   - 自我可扩展性--新的对等节点带来新
>     的服务能力，同时也增加了新的服务
>     需求
> -  对等节点可以间歇性互连和改变IP地址
>   - 管理非常复杂 

2、TCP与UDP:

> TCP：
>
> - TCP 可以提供的服务：数据的可靠传输、流量控制、拥塞控制
> - 不能提供的服务：时间控制、最小吞吐量保证、安全性
> - 是面向连接的方式：有连接的建立和拆除过程
>
> UDP：在DNS，流媒体等应用场景下使用
>
> - UDP 可以提供的服务：数据的不可靠传输
> - 不能提供的服务：可靠性、流量控制、 拥塞控制、时间保证、最小吞吐量保证、安全性
> - 是无连接的方式：没有连接的建立和拆除过程

3、Web 应用的应用层协议是 HTTP。（HTTP 采用 TCP 协议，80 端口）：

> 1）持续连接和非持续连接：
>
> - 持续连接：
>   - 在客户端和服务器之间多个对象可以基于一个TCP连接发送
> - 非持续连接：
>   - 通过TCP连接最多发送一个对象，然后关闭TCP连接
>   - 下载多个对象需要建立多个TCP连接
> - 非持续连接的响应时间：
>
> ![截屏2023-06-24 12.59.59](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 12.59.59.png)
>
> 2）基本的 HTTP 报文格式，请求报文和响应报文，前几个字段：
>
> - ![截屏2023-06-24 13.01.15](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 13.01.15.png)
> - 状态码：
>   - 200  OK
>   - 301  重定向
>   - 400  Bad Request
>   - 404  Not Found
>   - 505. Http Version not Supported
>
> 3）Cookie 的原理（4 个组件）及应用场景:
>
> - authorization(认证) 
> - shopping carts(购物车)
> -  recommendations(推荐) 
> - user session state (Web e-mail)(用户会话状态) 
> - 存在的问题：隐私泄露
>
> 4）web缓存：
>
> - 浏览器发送所有的 HTTP 请求给 cache(缓存服务器)
> -  如果请求对象存在于缓存服务器：缓存服务器直接返回对象给客户；如果请求对象不在 缓存服务器中，则缓存服务器向原始服务器请求，然后返回对象给客户
> - 使用 web 缓存（cache）的优点： 
>   -  减少对于客户端请求的响应时间
>   -  减少原始服务器接入链路的流量
>   -  Internet dense with caches: enables “poor” content providers to effectively deliver content (so too does P2P file sharing)
>
> 5）条件 Get：怎么确保缓存服务器上的 object 是最新的
>
> 具体方法：
>
> - 发送包含上次更新的时间
> - 如果没有发生修改，则返回一个空数据的响应报文 
> - 如果发生了修改，则返回一个最新的数据

4、文件传输应用的协议：FTP（TCP 协议，C/S，21 和 20 端口号）

> 有两个 TCP 连接：
>
> - 1 个用于控制连接（21，传输用户认证信息，浏览目录，文件请求命 令），
> - 1 个数据连接（20，专门用于传输文件数据）

5、电子邮件应用的协议：SMTP（TCP，C/S，25）、POP3（TCP，C/S）

> - 从客户端软件到发件人的邮件服务器：HTTP，SMTP
> -  从发件人的邮件服务器到收件人的邮件服务器：SMTP 
> - 从收件人的邮件服务器获取邮件到本地：pop、IMAP，HTTP 
> - 注意：邮件内容使用 ASCII 码编码，对于非 ASCII 的内容，采用 MIME 格式。

6、因特网域名查询 IP 地址的应用协议：DNS（UDP，C/S，53 端口）

> 1）DNS提供的服务：
>
> - 主机名到 IP 地址的转换 
> - 主机别名查询 (host aliasing)：应用程序可以调用 DNS 来获得主机别名所对应的规范主机名以及主机的 IP 地址。  
> - 邮件服务器的别名：电子邮件应用程序可以调用 DNS，对提供的邮件服务器别名进行解析，以获得该主机的规范主机名及 IP 地址。
> - 负载均衡 (load distribution)：一个域名对应多个 IP 地址及服务器，当一个 DNS 域名解析请求到达 DNS 服务器时，服务器依次使用 1 个 IP 地址作为响应，以实现负载均衡。
>
> 2）DNS 应用采用的是一种分布式数据库系统，为什么不采用集中式数据库系统？ 
>
> - 单一点失效、流量负担、远程的集中式数据库、维护开销大，不具有扩展性。
>
> 3）DNS 是一个分布式、层次化的数据库 
>
> - 根服务器：在因特网上有 13（247：2011）个根服务器，主要维护的是顶级域名服 务器的 IP 地址； 
> - 顶级域服务器（TLD）：维护顶级域名的 IP 地址
> - 权威 DNS 服务器：由组织机构维护的自己提供的服务器的域名到 IP 地址映射的 DNS 服务器。例如我们学校的 Web 服务器和电子邮件服务器的域名和 IP 地址的映射由我们学校自己的权威 DNS 服务器维护。
> - 本地DNS服务器
>
> 4）基于DNS的域名解析过程：迭代查询（左）和递归查询（右）
>
> ![截屏2023-06-24 23.01.07](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 23.01.07.png)

7、P2P 

> （1）P2P 结构的特点 ：
>
> - 直接在对等方（peer）间传输：所有内容不经过第三方服务器;
> - 高度的可扩展能力：利用众多对等方集合中的资源去分发内容; 
> - 使用客户机/服务器模式：请求的对等方是客户机，被选中的对等方是服务器。
> - 服务器对等方使用文件传输协议向客户机对等方传送；通过传送“HTTP 请求”和“HTTP 响应”报文进行；所有的对等方必须既能运行文件传输协议的客户机端程序，又能运行 服务器端程序；对等方既是一个客户机，又是一个瞬时 Web 服务器。

8、视频流和内容分发网络（content delivery network, CDN）：DASH 主要针对视频流，CDN 可以提供文件存储服务

> -  （1）DASH：流媒体服务器端可以将一个视频编码为不同的速率，每个速率的视频文件存为一个 URL，用户可以根据自己的网络状况选择一个适合自己的视频文件播放。
> -  （2）CDN：对于提供大型（实时性、并发性）服务的公司，通常建立数据中心来为用户提供服务，但是集中式的数据中心存在 3 个问题。**问题 1**：客户可能与服务器距离遥远，需要经过若干链路和路由器，甚至是跨越多个 ISP，导致数据传输的端到端延时较大；**问题 2**：许多相同的视频数据可能在一条链路上重复传输，对于骨干链路的带宽资源是一种浪费，更好的方法是相同的视频数据在若干公共的骨干链路上只传输 1 次，在接近用户终端的接入点在复制为多份发送给不同的终端用户；**问题 3**：集中式数据中心是单点，如果单点失效，将不能提供服务，好的改进是将视频数据备份在不同地点的服务器上。这就对应提出了 CDN 的概念。在不同的 ISP 的接入点（或交换点）各个大型公司分别建立自己的 CDN 集群，以备份数据。当用户访问 YouTube 的网站时，**实际访问的是距离用户最近的那个 CDN 集群的服务器。**

## 第二章练习题

![image-20230624131503102](/Users/qinjianwu/Library/Application Support/typora-user-images/image-20230624131503102.png)

```
根据提供的HTTP请求：

a. 浏览器请求的文档URL是"/cs453/index.html"  
b. 浏览器正在运行HTTP的1.1版本。
c. 浏览器请求的是一条持续连接，因为在请求中指定了"Connection: keep-alive"头部。
d. 提供的请求中未指定浏览器所运行主机的IP地址。
e. 发起请求的浏览器类型是Mozilla/5.0（Windows; U; Windows NT 5.1; en-US; rv:1.7.2）Gecko/20040804 Netscape/7.2（ax）。在HTTP请求报文中包含浏览器类型是为了向服务器提供客户端浏览器的功能和偏好信息。
```

## 第三章运输层

1、运输层提供的是（process-process）的数据传输服务。

> - TCP 提供可靠的、按序的数据交付服务：拥塞控制、流量控制、建立连接。
> -  UDP 提供不可靠的、不按序的数据交付服务：不建立连接。
> -  TCP 和 UDP 都不能提供数据传输的时延保证、最小带宽（吞吐量）保证。

2、TCP 和 UDP 的报文头部格式

> ![截屏2023-06-24 23.29.59](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-24 23.29.59.png)
>
> ![截屏2023-06-25 10.49.22](/Users/qinjianwu/Desktop/截屏2023-06-25 10.49.22.png)

3、UDP 协议

> - （1）使用 UDP 的应用层协议有哪些？DNS、SNMP 
> - （2）UDP 的优势 ：数据量小，传输快
> - （3）UDP 不提供数据可靠传输，因此如果应用程序需要保证数据可靠，需要在应用程序中实现数据可靠性。 
> - （4）校验和（checksum）：每16比特一段，按位求和，最高位有进位，则回卷，按位求反。

4、TCP 协议

> TCP 涉及到的可靠传输机制：定时器、重传、差错检测、正确确认、流水线
>
> - 流水线机制：GBN和SR
>
> ##### 回退N步GBN原理：
>
> - 在分组首部需要K比特序号， 2*k=N
> -  “窗口” 最大为N, 允许N个连续的没有应答分组
>
> ![截屏2023-06-25 10.27.01](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.27.01.png)
>
> 发送方：
>
> - 窗口内的分组分为已发送还未收到 ACK 确认的分组(黄色)，可发送还未发送的分组 （蓝色）。send_base 指向已发送但未收到 ACK 确认的分组的最小序号。
> - 收到发送方返回的 ACK(n)，表示接收方收到了所有比 n 小的序号的分组（累计确 认机制）；可能会收到重复的 ACK 确认包
> - 定时器，对最老已经发送还未收到确认 ACK 的分组（send_base）维护一个定时器；
> - 定时器超时机制，timeout(n)，重传所有已经发送还没有收到 ACK 确认的分组。
>
> 接收方：
>
> - 接收空间只有 1 个包的大小，如果是期望接收序号的包，就接收下来，向上层提交； 如果不是期望接收序号的包，则丢弃，返回 ACK(期望的序号)；
>
> - 注意：没有接收缓冲区。会发送一个重复的 ACK 确认。
>
> #### 选择重传SR原理：
>
> ![截屏2023-06-25 10.40.13](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.40.13.png)
>
> 发送方：
>
> - 维护发送缓冲区，有个滑动窗口，包括已发送未收到 ACK 确认的分组（黄色），已发送已收到 ACK 确认的分组（绿色），未发送分组（蓝色）； 
> - 收到 ACK(n)，在 SR 中，ACK 确认是针对单个分组的，收到对某个分组的 ACK 确 认，说明这个分组被接收方收到。 
> - 定时器，对当前已发送未收到确认的所有分组各自维护一个定时器，多个定时器； 
> - 定时器超时，某个序号的分组的定时器超时，则只重传超时对应的这个分组。
>
> 接收方：
>
> - 收到分组是期望序号的分组，则返回 ACK(n)给发送方； 
> - 对于收到的分组如果不是期望序号的分组，则缓存这个分组，发送按序到达的分组 的确认 ACK 给发送方。
>
> ![截屏2023-06-25 10.44.36](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.44.36.png)

5、TCP 协议的可靠传输机制

> （1）采用的机制：定时器/重传、ACK 确认（累计确认）、滑动窗口（发送方和接收方 								均采用滑动窗口，可缓存时序分组）
>
> ![截屏2023-06-25 10.49.02](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.49.02.png)
>
> - 序号：字节流中的位置
> - 确认号：期望从对方收到下一个字节的序号
>
> ![截屏2023-06-25 10.56.32](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.56.32.png)
>
> - 定时器（单个定时器）
>
>   - 只对发送窗口中最早的已发送未收到 ACK 确认的分组启动定时器，定时器超时，则只重传这个分组。如果收到这个最早已发送未确认分组的 ACK 确 认，则停止定时器，继续对当前窗口中已发送未确认的分组重新启动定时器。 定时器设置多长时间？
>
>   ![截屏2023-06-25 10.58.03](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.58.03.png)

6、TCP 协议的流量控制机制（原理）

> ![截屏2023-06-25 13.07.38](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 13.07.38.png)

7、TCP 的连接管理

> （1）TCP 的建立：三次握手：
>
> - 步骤 1：客户机向服务器发送 TCP SYN 报文段【表明准备好发送数据，不知服务器】 
>   - 指定初始序号（随机产生）seq=x， 
>   - 没有数据 
> - 步骤 2：服务器收到 SYN 报文段, 用 SYNACK 报文段回复。【已知客户端准备好发送 数据，表明自己准备好发送（接收）数据】 
>   - 服务器为该连接分配缓冲区和变量
>   - 指定服务器初始序号（初始化自己的序号 seq=y） 
> - 步骤 3：客户机接收到 SYNACK，用 ACK 报文段回复，可能包含数据【告诉服务器已经收到服务器确认（知道服务器准备好），发送数据】
>
> ![截屏2023-06-25 13.13.04](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 13.13.04.png)
>
> - 为什么不使用二次握手
>   - 三次握手的第2步中，服务器端将自己选择的初始序号发送给客
>     户端，因此客户端需要在第3步中向服务器确认此序号，可见二
>     次握手是不够的；
>
> （2）TCP 的释放：四次挥手
>
> ![截屏2023-06-25 13.18.03](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 13.18.03.png)
>
> - 步骤 1: 客户机向服务器发送TCP FIN控制报文段【告知服务器，客户端不再发送数据， 但是可以接收来自服务器的数据】
> - 步骤 2: 服务器收到 FIN，用 ACK 回答。关闭连接，发送 FIN，【告知客户端，服务器不再接收数据，但是仍然可以发送数据给客户端】
> - 步骤 3: 客户机收到 FIN, 用 ACK 回答，进入 “超时等待” – 将对接收到的 FIN 进行确认【收到服务器的结束消息，知道服务器不再发送数据，但仍然不会马上释放缓冲区， 需要等待一个时间，因为服务器还可能有数据包正在网络中传输】 
> - 步骤 4: 服务器接收 ACK，连接关闭

8、TCP 协议的拥塞控制机制

> LastByteSent - LastByteAcked <= cwnd
> 速率 = cwnd / RTT   bytes/sec
> MSS通常为1460bytes
>
> - TCP加增倍减AIMD
>   - 乘性减:
>     - 丢包事件后，拥塞窗口值减半
>   - 加性增:
>     - 如没有检测到丢包事件，每个RTT时间拥塞窗口值增加一个MSS (最大报文段长度)
>
> ##### TCP慢启动：
>
> - 在连接开始时, 拥塞窗口值 = 1 MSS
>   - 例如: MSS= 500 bytes & RTT = 200 msec
>   -  初始化速率 = 20 kbps
> -  可获得带宽可能 >> MSS/RTT
>   - 希望尽快达到期待的速率
> - 当连接开始，以指数倍增加速率，直到第一个丢失事件发生
> - 当连接开始的时候，速率呈指数式上升，直到第1次报文丢失事件发生为止:
>   - initially cwnd = 1 MSS
>   - double cwnd every RTT
>   - done by incrementing cwnd forevery ACK received（每收到1个ack确认， cwnd增加1个MSS）
> - 总结: 初始速率很低，但指数倍增加
>
> ![截屏2023-06-25 13.52.10](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 13.52.10.png)
>
> ##### 慢启动到拥塞避免状态
>
> - 什么时候从指数增长转变为线性增长?
>   - cwnd达到它超时以前1/2的时候（慢启动阈值）
> - 实现方法:
>   - 设置一个阈值ssthresh（慢启动阈值）
>   - 在丢包事件发生时，阈值ssthresh设置为发生丢包以前的cwnd的一半
>
> ![截屏2023-06-25 13.56.04](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 13.56.04.png)
>
> ##### 拥塞避免状态
>
> - 当处于慢启动状态， 拥塞控制窗口cwnd大于等于ssthresh时， 发送方进入拥
>   塞避免状态；
>
> - 在该状态拥塞窗口cwnd在每个RTT， 值增加一个MSS， 即每新收到一个
>   ACK:
>
>   cwnd = cwnd + MSS(MSS/cwnd)
>
>   - 例如， MSS = 1460字节， cwnd = 14600字节， 则在一个RTT之内可以发送10个报文段， 每个ACK到达， 拥塞窗口增加1/10MSS， 在收到10个报文段的ACK后， 拥塞控制窗口增加1个MSS
>
> ##### 拥塞如何检测及发生拥塞后的处理
>
> - 收到3个冗余确认后:
>   - cwnd减半
>   - 进入快速恢复状态
> - 收到超时事件以后：返回慢启动状态
>   - cwnd值设置为1 MSS
>   - 窗口再指数增长
>   - 到达一个阈值 (Threshold) 后，再线性增长
>
> ##### 快速恢复状态
>
> - 当发送方收到来自于接收方3个重复的ACK报文时， 进入快速恢复状态； 3个重复的ACK报文触发的动作包括： **当前的状态可以是慢启动或者拥塞避免**
>   - ssthresh = cwnd/2
>   - cwnd = ssthresh+3*MSS
>   - 重传丢失的报文
> - 当处于快速恢复状态时（此时网络可能发生拥塞） ：
>   - 如果收到一个重复的ACK， cwnd = cwnd + 1 MSS
>   - 当收到一个新的ACK（即期望报文的ACK） ， TCP在降低拥塞控制窗口后进入拥塞避免状态； cwnd = ssthresh
>   - 当发生超时事件， 说明已经发生拥塞，进入慢启动状态
>     - ssthresh = cwnd/2
>     - cwnd = 1 MSS
>     - 重传丢失的报文
>
> ##### TCP 拥塞控制：小结
>
> - 当cwnd < ssthresh时，发送者处于慢启动阶段, cwnd指数增长
> - 当cwnd >= ssthresh时，发送者处于拥塞避免阶段， cwnd线性增长
> - 当出现3个冗余确认时， ssthresh设置为cwnd/2， 且cwnd设置为
>   ssthresh+3*MSS
> - 当超时发生时， ssthresh设置为cwnd/2，并且cwnd设置为1 MSS.
>
> ##### 结合 TCP 拥塞控制状态转移图 
>
> - （1）早期的 Tahoe 机制：慢启动、拥塞避免 
> - （2）目前的 Reno 机制：慢启动、拥塞避免、快速恢复（了解为什么引入快速恢复状态 快速恢复状态的加入，为了能够更高效的利用网络的传输能力） 要能够结合图，掌握每种状态下，cwnd 的变化规则、因为什么事件会发生什么样的状 态转移； 
> - （3）三个状态的进入规则，在三个状态，拥塞窗口的变化规则。

## 第三章练习题

![截屏2023-06-25 10.20.14](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.20.14.png)

```
校验和与校验码相加全为1则没有比特错误，否则有
```

![截屏2023-06-25 10.36.05](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.36.05.png)

![截屏2023-06-25 10.46.50](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 10.46.50.png)

![截屏2023-06-25 11.47.40](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 11.47.40.png)

![截屏2023-06-25 11.47.55](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 11.47.55.png)

![截屏2023-06-25 12.16.33](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 12.16.33.png)

![截屏2023-06-25 12.23.54](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 12.23.54.png)

![截屏2023-06-25 13.06.09](/Users/qinjianwu/Desktop/截屏2023-06-25 13.06.09.png)

## 第四章-网络层：数据平面

**网络层分为数据平面和控制平面。数据平面的主要功能是进行路由器内部的数据报文从输入端口到输出端口的转发。控制平面的主要功能是帮助计算网络全局的路由，例如路由算法计算每个路由器上的转发表，实现整条路径的计算。**

1、因特网的网络层提供的服务

> - 单一服务，即尽力而为服务(best-effort service) 。
> - 分组间的定时不能被保证； 
> - 分组的接收顺序与发送顺序不一定相同； 
> - 传送的分组不能保证最终交付，即网络可能未向目的地交付分组

2、路由器的体系结构和组件的功能
	 输入端口、输出端口、交换结构（基于内存、基于总线、crossbar）、路由处理

> ###### 输入端口：
>
> - 转发表存储在输入端口的内存中
>
> - 第一个线路端接模块：将一条物理链路端接到路由器的物理层；
>
> - 第二个数据链路处理模块：实现路由器的数据链路层功能；
>
> - 第三个查找与转发模块：实现查找与转发功能，以便分组通过路由器交换结构转发到适当的输出端口；
>
>   ![截屏2023-06-25 16.38.32](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.38.32.png)
>
> ###### 交换结构：
>
> ![截屏2023-06-25 16.47.35](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.47.35.png)
>
> - **基于内存**：
>   - 早期用计算机作为路由器时采用的结构(第一代)
>     - 输入端口与输出端口之间的交换由CPU(选路处理器)控制完成；
>     - 输入端口与输出端口类似I/O设备：
>       - 当分组到达输入端口时，通过中断向选路处理器发出信号，将分组拷贝到处理器内存中；
>       - 选路处理器根据分组中的目的地址查表找出适当的输出端口，将该分组拷贝到输出端口的缓存中。
>
> - **基于总线**：
>   - 输入端口通过一条共享总线将分组直接传送到输出端口，不需要选路处理器的干预
>   - 每次只能有一个分组通过总线传送，分组可以被总线上的每个端口接收，只有标签正确的端口将其存储；
>   - 分组到达一个输入端口时，若总线正忙，会被暂时阻塞，在输入端口排队
>   - 路由器交换带宽受总线速率限制。
>
> - **基于互联网络交换（crossbar）:**
>
>   - 纵横式(crossbar)交换机： 由2n条总线组成， n个输入端口与n个输出端口连
>     接
>   - 到达输入端口的分组沿水平总线穿行，直至与所希望的输出端口的垂直总线交叉点：
>     - 若该条垂直总线空闲，则分组被传送到输出端口；
>     - 否则，该到达的分组被阻塞，必须在输入端口排队。
>
>   ![截屏2023-06-25 16.52.01](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.52.01.png)
>
> ###### 输出端口：
>
> - 取出存放在输出端口内存中的分组，并将其传输到输出链路上。
>
> - 当交换结构将分组交付给输出端口的速率超过输出链路速率，就需要排队与缓存管理功能。当输出端口的缓冲区溢出时，就会出现延时和丢包
>
>   ![截屏2023-06-25 16.54.23](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.54.23.png)
>
>   
>
> **输入端口排队**：
>
> - 当交换结构的速度慢于输入端口的速度，就会在输入端口的缓冲区发生排队
>
> - 会导致排队延时和由于输入缓冲区溢出导致的丢包！
>
> - 线头阻塞（Head-of-the-Line (HOL) blocking） : 在队列前面的被阻塞的数据报会阻止队列中的其他数据报被转发
>
>   ![截屏2023-06-25 16.56.38](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.56.38.png)
>
>   
>
> **输出端口排队：**
>
> - 当数据报从交换结构到达输出端口的速率超过输出端口的传输速率，则需
>   要缓存数据报
>
> - 调度机制用来在队列中选择传输的数据报
>
>   ![截屏2023-06-25 16.58.13](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 16.58.13.png)
>
> ###### 分组调度：
>
> - FIFO (first in first out) 调度: 根据到达队列的顺序发送	
> - 优先级调度
> - round - robin
>
> 

3、目的 IP 地址的转发规则：最长前缀匹配

> 对于给定的目的地址，使用最长地址前缀匹配来完成输出端口的查找
>
> 存在多个匹配：使用最长前缀匹配规则，即向与最长前缀匹配的链路接口转发分组

4、网络层协议及网络层头部字段

> ![截屏2023-06-25 17.15.30](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.15.30.png)
>
> ![截屏2023-06-25 17.16.31](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.16.31.png)

5、IPv4 数据报分片和重组

> ![截屏2023-06-25 17.20.40](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.20.40.png)

6、IPv4 编址

> 早期的分类编址：根据不同的取值范围，早期将IP地址分为五类
>
> - IP地址中前5位用于标识IP地址的类别
> - A类地址的第一位为“0” ，
> - B类地址的前两位为“10” ，
> - C类地址的前三位为“110” ，
> - D类地址的前四位为“1110” ，（组播）
> - E类地址的前五位为“11110” 。（实验）
> - A类、 B类与C类地址为基本的IP地址

> ![截屏2023-06-25 17.27.19](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.27.19.png)

> - 子网、子网掩码的概念，IPv4 寻址 
>
>   - 子网定义：为了确定子网，分开主机和路由器的每个接口，从而产生了几个分离的网络岛，这些独立网络中的每一个叫做一个子网(subnet).
>   - 子网掩码：用全1表示网络位，全0表示主机位
>
> - IPv4寻址：
>
>   - 属于相同子网的主机通信，可以直接发送分组，不需要路由器参与；
>   - 属于不同子网的主机通信， 发送主机首先将分组发送到它的网关路由器，
>     由路由器帮助它转发分组到接收主机；
>   - 路由器将根据分组的目的IP地址所属的子网地址，来查找其对应的输出端
>     口，将分组输出到接收主机或下一跳路由器，直到分组被接收主机接收。
>
>   ![截屏2023-06-25 18.49.33](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 18.49.33.png)
>
>   ![截屏2023-06-25 18.51.45](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 18.51.45.png)
>
>   
>
> - 子网可以用/X 表示，也可以用子网掩码表示。 
>
> - 一个网络接口，需要配置一个 IP 地址以及它对应的子网掩码。 
>
> - 一个网络接口属于的子网，是用其 IP 地址与子网掩码进行掩码运算得到的。 
>
> - 寻址；一个网络接口发送数据报，首先判断目的 IP 地址与自己的 IP 地址是否属 于同一子网。
>
> - 方法；IP 地址与本地的子网掩码进行掩码运算，对于同一子网的目的主机，直接发送该数据报文到目的主机。如果不属于同一子网，在将数据报首先发送给默认网关，由默认网关协助转发到目的主机。

7、子网划分

> - 定长和变长子网划分。 
> - 首先确定子网数和每个子网需要分配的主机数。首先满足主机数最多的子网。确定借位的比特数，然后进行进一步细分。 
> - 每个子网的地址分配范围要排除，主机位全 0 和主机位全 1 的地址。

> ![截屏2023-06-25 19.00.24](/Users/qinjianwu/Desktop/截屏2023-06-25 19.00.24.png)
>

> ![截屏2023-06-25 19.19.42](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 19.19.42.png)
>

8、DHCP 动态地址配置（过程）

> 动态主机配置协议获取（DHCP）：允许一个主机自动获取以下信息
>
> - IP地址、子网掩码、默认网关、 DNS地址
> - plug-and-play（即插即用）
>
> ![截屏2023-06-25 19.22.39](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 19.22.39.png)

9、网络地址转换（NAT）原理

> ![截屏2023-06-25 19.30.57](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 19.30.57.png)



## 第四章数据平面练习题

> ![截屏2023-06-25 17.04.02](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.04.02.png)

> a.
>
> | 目的地址   | 输出端口 |
> | ---------- | -------- |
> | H3(IP地址) | #3       |
> | H2         | #2       |
> | H1         | #1       |
>
> b.不能实现，因为相同IP地址对应的输出端口相同

> 
>
> ![截屏2023-06-25 17.10.14](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.10.14.png)

> | Prefix Match      | Link Interface |
> | ----------------- | -------------- |
> | 11100000 00       | 0              |
> | 11100000 01000000 | 1              |
> | 1110000           | 2              |
> | 11100001 1        | 3              |
> | otherwise         | 3              |



> ![截屏2023-06-25 17.21.25](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.21.25.png)

> ![截屏2023-06-25 17.22.04](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 17.22.04.png)



> ![截屏2023-06-25 18.57.07](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 18.57.07.png)
>
> ![截屏2023-06-25 18.57.38](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 18.57.38.png)

## 第四章-网络层：控制平面

1、路由算法：**链路状态路由算法（全局算法）、距离向量算法（分布式算法）**

> #### 链路状态路由算法
>
> ##### Dijkstra算法:
>
> ```
> 1）初始化:
>  N' = {u}
>  对所有节点v
>  if v 临近 u
>  then D(v) = c(u,v)
>  else D(v) = ∞
> 2）找出一个到源节点的费用最低的节点w，并以此更新其它点D(v) 值；
> 		从不在N' 中的节点中找出一个D(w)值最小的节点w，并将w加入到N' 中。 
> 		对不在N‘ 中，但与节点w是邻居的节点v，用新的值更新
> 				D(v)=min[D(v)， D(w)+c(w, v)]
> 		将节点v原值与节点v现经节点w到源节点的值比较，取小值。
> 3）重复步骤(2)
> ```
>
> ![截屏2023-06-25 19.50.54](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 19.50.54.png)
>
> - 缺陷：产生振荡
>   - c(u， v)与c(v， u)仅当在链路(u， v)两个方向的负载相
>     同时才相等。
> - 避免振荡：
>   - 避免所有的路由器同时运行LS算法：比较合理。
>     - 即使路由器以相同周期(每30分钟)运行LS算法，在每个节点上算法的执
>       行时刻也不同
>   - 因特网的自同步：
>     - 即使路由器初始时以同一周期但不同时刻执行算法，算法执行时刻最终会同步并保持。采用随机时间的方法，即每台路由器随机发送链路通告。
>
> #### 距离向量算法
>
> ##### DV算法：
>
> - dx(y)：节点x到节点y的最低费用路径的费用。
>
> $$
> dx
> (y) = minv [ c(x, v)+ dv(y) ]
> $$
>
> - c(x, v)+ dv(y)： x与某个邻居v之间的直接链路费用c(x, v)加上邻居v到y的最小费
>   用，即x经v到节点y的最小的路径费用。
>
> - minv ：从所有经直接相连邻居到节点y的费用中选取的最小路径费用。
>
>   ![截屏2023-06-25 20.16.04](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.16.04.png)
>
>   ![截屏2023-06-25 20.19.46](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.19.46.png)
>
> ###### 链路费用改变与链路故障：
>
> - 链路费用减少
>
>   - 如图，当y 到x的链路费用从4变为1的情况
>
>   - ![截屏2023-06-25 20.32.39](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.32.39.png)
>   - t0： y 检测到x的链路费用从4变为1，更新其距离向量，并通知其邻居z；
>   - t1： z收到来自y的更新报文，并更新自己的距离表，此时到节点x的最低费用减为2，并通知其邻居y；
>   - t2： y收到来自z的更新报文，并更新自己的距离表，此时到节点x的最低费用不变仍为1。不发送更新报文，算法静止。
>
> -  某链路费用增加时情况
>
>   - 如图，设x与y之间的链路费用从4增加到60
>   - ![截屏2023-06-25 20.38.24](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.38.24.png)
>   - 需要迭代 44 次，才能达到正确的距离向量信息。（这里的次数迭代有点理解上的误差，理解它的工作原理就行）



2、路由协议，简单的 OSPF(链路状态路由算法)、BGP（距离向量路由算法）

> **因特网中自治系统内部的路由选择**：
>
> - 使路由具有可扩展性
>   - 我们目前的研究是非常理想化的
>     • 所有路由器都是相同的
>     • 网络是扁平的
> -  扩展性问题：数十亿的目的主机
>   - 在路由转发表中无法存储所有的目的主机的地址
>   - 路由表的交换将淹没链路的带宽容量
> - 行政上的自治问题：
>   - 因特网是由各种网络互联而成的
>   - 每个网络的管理者会希望由自己来控制自己网络中的路由信息
>
> - intra-AS 路由(域内)
>   - 位于相同AS的主机和路由器之间的路由
>   - 在AS内部的所有路由器必须运行相同的域内路由协议
>   - 位于不同AS的路由器可以运行不同的域内路由协议
>   - 网关路由器：位于AS的边缘，有链路连接到其他AS的路由器
> - inter-AS 路由(域间)
>   - AS之间的路由
>   - 网关执行域间路由协议
> - 转发表的配置由域内和域间路由算法完成
>   - intra-AS 路由确定AS内部的目的地址的转发表项
>   - inter-AS & intra-AS 确定外部目的地址的转发表项
>
> **开放最短路径优先OSPF（域内路由协议）**：
>
> - “open” : 公开可用
> - uses link-state algorithm
>   - link state packet 扩散
>   - 每个节点维护拓扑图
>   - 使用Dijkstra算法计算路由
> - 路由器泛洪OSPF link-state 公告给所有的位于同一个AS的路由器
>   - OSPF消息直接封装在IP报文中(而不是TCP或UDP报文段)
>   - link state: 每条直接相连的链路
> - ![截屏2023-06-25 20.53.25](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.53.25.png)
> - 优点：
>   - 安全: 所有OSPF消息都是加密的(以防止恶意入侵)
>   - 允许多条有相同开销(cost)的路径(在RIP协议中只允许1条)
>   - 对于每条链路，针对不同的TOS可以设置不同的cost(例如，对于best effort ToS 可以将cost设得较低，而对于real-time ToS 可以设得较高)
>   - 支持在单个AS中的层次结构
>
> **ISP之间的路由选择： BGP（域间路由协议）**
>
> - BGP (Border Gateway Protocol): 域间路由协议
>   - 粘合数以千计的ISP
> - BGP为每个AS提供如下功能:
>   - eBGP(外部): 从其邻居AS获得子网的可达信息
>   - iBGP(内部): 传播可达信息给AS内部的所有路由器.
>   - 基于可达信息和策略，确定到其他网络的好路由（并不一定是最优）
> - 允许子网(subnet)向英特网公告它自己的存在信息:“I am here”
> - ![截屏2023-06-25 20.57.46](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.57.46.png)

2、SDN 体系结构的关键特征：

> - （1）基于流的转发。
> - （2）数据平面与控制平面分离。
> - （3）网络控制功能：位于数据平面交换机外部。
> - （4）可编程的网络。

 3、OpenFlow 协议的作用

> - OpenFlow 协议运行在 SDN 控制器和（SDN 控制的）交换机 或其他（实现 OpenFlow API 的）设备之间。

## 第四章控制平面练习题



> DV算法：
>
> ![截屏2023-06-25 20.29.12](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.29.12.png)

> LS算法：
>
> ![截屏2023-06-25 20.29.55](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 20.29.55.png)

> ![截屏2023-06-25 21.01.42](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 21.01.42.png)

> ```
> 政策：在AS之间，政策问题占主导地位。源自某一特定AS的流量不能通过另一特定AS，这一点很重要。同样，一个给定的AS可能想控制它在其他AS之间携带的过境流量。在一个AS内，一切都在名义上处于相同的行政控制之下，因此政策问题在选择AS内的路由时的作用要小得多。
> 
> 规模：路由算法及其数据结构的扩展能力，以处理大量网络之间的路由，是AS间路由的一个关键问题。在AS内部，可扩展性是一个不太重要的问题。首先，如果一个管理域变得太大，总是有可能把它分成两个AS，并在两个新的AS之间执行AS间路由。
> 
> 性能：由于AS间的路由是以政策为导向，所使用的路由的质量（例如，性能）往往是次要的（也就是说，满足某些政策标准的较长或较昂贵的路由很可能被采用，而不是较短但不符合该标准的路由）。事实上，我们看到，在AS之间，甚至不存在与路由相关的成本概念（除了AS跳数）。然而，在单一的AS中，这种政策问题就不那么重要了，允许路由更多的关注在路由上实现的性能水平。
> ```

> ![截屏2023-06-25 21.03.18](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 21.03.18.png)
>
> ```
> 在OSPF中，一个路由器向其所属的自治系统中的所有其他路由器广播其链路状态信息，而不仅仅是向其邻近的路由器广播。这是因为在OSPF中，每个路由器需要构建整个AS的完整拓扑图，然后在本地运行Dijkstra的最短路径算法，以确定其到同一AS中所有其他节点的最低成本路径
> ```

> ![截屏2023-06-25 21.04.31](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-25 21.04.31.png)
>
> ```
> OSPF自治系统中的一个区域是指一组路由器，其中每个路由器将其链路状态广播给同一组的所有其他路由器。一个OSPF AS可以分层次地配置成多个区域，每个区域都运行自己的OSPF链路状态路由算法。在每个区域内，一个或多个区域边界路由器负责对区域外的数据包进行路由。 区域的概念是出于可扩展性的考虑而引入的，也就是说，我们希望为一个大规模的OSPF AS建立一个分层路由，而区域是分层路由的一个重要构件。
> ```

## 第五章-链路层

常用术语：

> - 节点：主机和路由器（包括网桥和交换机）
>
> - 链路：沿着通信路径连接相邻节点的通信信道。包括：有线链路，无线链路，局域网。
>
> - 帧：链路层协议交换的数据单元。
>
> - 数据链路层职责🤠：**将数据**分组通过一个链路，从一个节点传输到临近的另一个节点。
>
>   不同的链路可以使用不同的协议，每个协议提供不同的服务🍧。
>
> 提供的服务：
>
> - 封装成帧：把网络层数据加头（源 MAC 和目的 MAC 等等）加尾，封装成帧。
> - 链路访问：媒体访问控制协议（MAC）规定了帧在链路上传输的规则，包括点对点链路和广播链路。
> - 邻接节点之间可靠传输：通常用于易于产生高差错率的链路，例如无线链路。

1、链路层是负责单条链路的数据传输，每条链路可以采用不同的链路层协议，例如一段链路是采用无线（802.11），另一段链路是有线的（以太网，802.3）。

2、链路层提供的功能

> 1）**封装成帧，链路接入：**
>
> - 封装数据报为数据帧，增加头部，尾部信息；如果是共享链路，接入链路；在数据帧头部中，用 MAC 地址来标识源和目的 MAC 地址，不同于 IP 地址；
>
> 2）**在相邻节点之间可靠传输数据帧**（以太网不提供）
>
> 3）**流量控制**
>
> - 用于控制发送节点向直接相连的接收节点发送数据帧的频率
>
> 4）**差错检查**
>
> - 差错可能由信号衰减、噪声引入，接收方检测是否出现错误，通知发送方重传或丢弃数据帧
>
> 5）**半双工和全双工**
>
> - 在半双工模式，链路的两个节点都可 以发送数据，但是不能同时发送
>
> 6）**链路层在 “适配器” （网卡）中实现** 
>
> - Ethernet 卡，PCMCIA 卡， 802.11 卡
> - 许多功能由硬件实现，高层链路层功能（组装链路层寻址信息等）通过软件实现。

3、三种主要差错检测技术：

> ###### 差错检测：
>
> - EDC =  Error Detection and Correction bits  错误检测和纠错位
> - 数据在节点之间传输时，网络层传入的数据 D 和 采用特定差错检测技术生成的 EDC 一并传输。
> - 接收方检测并纠错的能力被称为： 前向纠错 FEC ， 避免了端到端数据重发的传输时延
> - 奇偶校验：最基本的方法。
> - 检查和方法：常用于运输层。
> - 循环冗余检测：常用于链路层
>
> ###### 奇偶校验
>
> - 串行接口发送数据的校验方法
> -  发送方：
>   - 在要发送的信息D（d位）后面附加一个奇偶校验位
>   - 使“1” 的个数是奇数（奇校验） 或偶数（偶校验）
>   - 一起传输发送（d+1位）
> - 接收方：
>   - 检测收到的信息（d+1位）中“1” 的个数。
>   - 偶校验： 发现奇数个“1” ，至少有一个比特发生差错（奇数个比特差错）。
>   - 奇校验： 发现偶数个“1” ，至少有一个比特发生差错。
>
> **二维奇偶校验**
>
> - 将要传信息D（d比特）划分为i行j列（i 个组，每组 j 位） ；
>   - 对每行和每列分别计算奇偶值；
>   - 结果的i+j+1个奇偶比特构成了帧的差错检测比特。
>   - ![截屏2023-06-26 15.43.24](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 15.43.24.png)
>
> ###### 校验和（UDP,TCP校验和）
>
> - 发送方：
>
>   - 将数据的每两个字节当作一个16位的整数，可分成若干整数；
>   - 将所有16位的整数求和；
>   - 对得到的和逐位取反，作为检查和，放在报文段首部，一起发送。
>
> - 接收方：
>
>   - 对接收到的信息 (包括检查和)按与发送方相同的方法求和。
>     - 全“1” ：收到的数据无差错
>     - 其中有“ 0” ：收到的数据出现差错
>
>   ![截屏2023-06-26 15.49.31](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 15.49.31.png)
>
> ###### 循环冗余检测
>
> - 循环冗余检测CRC (cyclic redundancy check)编码： 
>
>   - 即多项式编码，把要发送的比特串看作为系数是0或1的一个多项式，对
>     比特串的操作看作为多项式运算。
>
>   - $$
>     10111 -> x4+x2+x+1
>     $$
>
> - 基本思想：
>
>   - 设发送节点要把数据D（d 比特）发送给接收节点。
>   - 发送方和接收方先共同选定一个生成多项式G（r+1比特）， 最高有效位(最左边)是1
>
> - 发送方：
>
>   - 计算出一个r位附加比特R， 添加到D的后面产生DR（d+r 比特）
>   -  DR能被生成多项式G模2运算整除，一起发送。
>
> - 接收方：
>
>   - 用生成多项式G去除接收到的DR（d+r比特）
>     - 余数非0：传输发生差错； 
>     - 余数为0：传输正确，去掉尾部r位，得所需数据D。 
>
>   - 当不通过 CRC 检测时（余数非零），链路层丢弃该帧**（以太网）**。
>
>   ![截屏2023-06-26 15.55.05](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 15.55.05.png)
>
> - 计算 CRC 比特流程：
>   - 假设除数 G 有 r+1 位，则在原始数据 D 之后补充 r 个 0，随后利用模 2 除法计算得到余数，余数就是所求 CRC 比特。
>
> 例如：
>
> ![截屏2023-06-26 15.57.39](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 15.57.39.png)
>
> - 原始数据 D 为 `10111`，除数 G 为`1001`共 4 位，则在 D 之后补充 3 个 0，随后利用**模 2 除法**计算 `101110000 / 1001`的余数即可。该例中余数为 `011` ，即为 CRC 比特。

4、两种链路：点到点链路、广播链路（共享信道）

> **点到点链路**：
>
> - 链路两端各一个节点。一个发送和一个接收。如，点对点协议PPP
>
> **广播链路**：
>
> - 多个节点连接到一个共享的广播信道

5、多路访问协议

> ##### 1）信道划分协议
>
> - ###### 时分TDMA：
>
>   - 每个节点轮流访问信道，只能在自己分配的时隙中使用信道，未被使用的时隙空闲
>
> - ###### 频分FDMA：
>
>   - 信道被分成不同频段，每个节点分配一个固定的频段，未被使用的频段空闲
>
> - ###### 码分CDMA：
>
>   - 为节点分配一种不同的编码，使其能够同时传输且被正确接收。通常用于无线信道之中。
>
> ##### 2）随机访问协议
>
> -  在随机接入协议中，一个传输节点总是以信道的全部速率（即 R bps）进行发送。当有碰撞时，涉及碰撞的每个节点反复地重发它的帧（也就是分组），到该帧无碰撞地通过为止。但是当一个节点经历一次碰撞时，它不必立刻重发该帧。相反，它在重发该帧之前等待一个随机时延。
>
> - ###### ALOHA协议：
>
>   - **纯ALOHA**：
>     - p  (1-p) * 2(N-1)
>     - 不按时隙划分，随机发送📢。冲突后立即以概率 p 重发。最高效率： 1/2e = 0.18 
>   - **时隙ALOHA**：
>     - N个节点中，任意节点成功传送的概率： Np(1-p) * （N-1）
>     - 时间划分为相同大小的时隙，一个时隙等于传送一个帧的时间。节点只能在一个时隙的开始才能传送。
>     - 冲突后，在下一个时隙以概率 p 重发。
>     - 最高效率：1/e = 0.37 
>
> - ###### 载波侦听多路访问CSMA：
>
>   - 载波侦听：
>     - 传送前侦听信道，如果信道空闲，传送整个帧；
>     - 如果信道忙，延迟传送。
>   - 存在问题：
>     - 由于传播延迟，可能导致两个节点没监听到其他节点的传送导致发生冲突，浪费带宽。
>   - **距离**和**传播延迟**决定冲突概率。
>
> - ###### 具有碰撞检测的载波侦听多路访问(CSMA/CD)：
>
>   -  在载波侦听的基础上加入 CD （冲突检测），优点是放弃会发生冲突的传送，减少带宽浪费。
>
>      基本思想：
>
>     1. 当一个节点要发送数据时，首先监听信道，看是否存在载波。
>
>     2. 如果信道空闲，则发送数据，如果信道忙，则继续监听，一旦发现空闲立即发送。
>
>     3. 发送过程中未检测到碰撞，则传输成功；否则停止正常发送，反而发送一短暂的**干扰信号 jam**，强化冲突，让其他节点都知道出现了冲突。
>
>     4. 发送干扰信号后，指数退避一随机时间。假设该帧经过 n 次冲突后，适配器在 
>        $$
>        {0,1,2...2^{m}-1}
>        $$
>        中随机选取一个值 K，其中 
>        $$
>        m = \min\{n,10\}
>        $$
>        ，然后等待 K*512 （以太网）比特时间后，回到第 2 步。
>
>   - 效率：
>
>     - ![截屏2023-06-26 16.30.18](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 16.30.18.png)
>
>   - 以太网的二进制指数回退
>
>     - 当传输一个给定帧时，在该帧经历了一连串的n次碰撞后，结点随机地从{0,1,2…. 2^n-1}中选择一个K值， NIC waits K·512 bit times
>     - 假设是100Mbps的以太网，那么发送512bit的时间是5.12*10-6秒
>       • 第一次碰撞： {0, 1}
>       • 第二次碰撞： {0, 1, 2, 3}
>       • 第三次碰撞： {0, 1, 2, 3, 4, 5, 6, 7}
>
> ##### 3）轮流协议
>
> |          | 高负载             | 低负载                                              |
> | -------- | ------------------ | --------------------------------------------------- |
> | 分割信道 | 信道共享，公平高效 | 延迟访问，如果只有一个活跃节点，只分配了 1/N 的带宽 |
> | 随机访问 | 冲突开销大         | 效率高，单个节点可以获得整个信道                    |
>
> 轮转协议是两者的折中
>
> - ###### 轮询协议：
>
>   - 从节点中选择一个作为主节点，主节点轮流向其他节点发送报文，告诉它能够传输帧的最大数量，待其传输完成后，再向下一个节点发送报文，依此类推。
>
> - ###### 令牌传递协议：
>
>   - 一种称为令牌的特殊帧在节点之间以固定次序进行交换，当一个节点收到令牌时，它才能发送数据，发送完毕后将令牌传递给下一个。

6、以太网的 CSMA/CD 协议的运行原理

> - （1）适配器从网络层获得一个数据报，封装成帧，准备发送；
> - （2）如果适配器侦听到信道空闲，开始传输帧；如果检测到信道繁忙，将等待一段时间，直到侦听到信道空闲， 开始传输帧；
> - （3）在传输过程中，适配器会同时监听是否有其他适配器的信号能量；如果适配器在整个帧的传输过程中，没有监听到其他信号，则完成该帧的传输；如果监听到来自其他适配器的信号，则中止传输帧；
> - （4）中止传输后，适配器会等待一个随机时间，重新执行步骤 2。关键是延迟的时间：【二进制指数回退】

7、链路层寻址 - ARP

> - **主要作用： 完成 32 位 IP 地址与 48 位 MAC 地址之间的转换。**
>
>   广播地址： FF-FF-FF-FF-FF-FF
>
>   MAC 地址具有扁平结构，而且无论到哪都不会变化。类比身份证号。
>
>   IP 地址具有层次结构（分为网络和主机部分），会随着主机移动而改变。类比住址。
>
>   ![截屏2023-06-26 16.59.34](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 16.59.34.png)
>
>   
>
> - ARP 工作原理（假设主机 A 向主机 B 发送）：
>
>   1. 查询发送方的 ARP 表中是否存在目标 IP 的记录。如果存在则顺利完成解析。
>   2. 如果 B 的 MAC 地址不在 A 的 ARP 表中，则 A **广播**（即目标 MAC 地址为 FF-FF-FF-FF-FF-FF）包含 B 的 IP 地址的 ARP 查询包。在局域网上所有的机器都能收到 A 发送的 ARP 查询包。
>   3. 主机 B 收到 ARP 查询包，发现是其中包含自己的 IP 地址，则**单独发送**一个带有自己 MAC 地址的包给 A。
>   4. A 收到后在自己的 ARP 表中缓存 IP-to-MAC 直到信息过期。
>
>   **需要注意的是：ARP 只为在同一个子网上的主机和路由器接口解析 IP 地址。跨网段间的数据传递需要路由器的参与。**
>
>   
>
> - 位于同一局域网的两台主机通信：
>
>   - 主机中的ARP互相缓存有ip地址与mac地址映射
>   - ARP 只为在同一个子网上的主机和路由器接口解析 IP 地址。跨网段间的数据传递需要路由器的参与。
>
> - 位于不同局域网的两台主机通信：
>
>   - ![截屏2023-06-26 17.07.55](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.07.55.png)
>   - • 数据帧从主机A发送到路由器R
>     • 路由器R收到数据帧，抽取出数据报递交到IP层
>   - ![截屏2023-06-26 17.09.07](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.09.07.png)

9、以太帧的结构

> **把 IP 分组（或其它网络层协议包）封装在 Ethernet 帧中**
>
> - Preamble: 前同步码，8 个字节
>   - 前 7 个字节为 10101010，最后一个为 10101011
>   - 用于发送方和接收方的时钟同步
> - Addresses: MAC 地址，6 个字节
>   - 如果适配器收到的帧的目的地址与之匹配或者是一个广播地址（ARP 包），就把帧传给网络层
>   - 否则，抛弃该帧
> - Type: 类型，2 个字节，
>   - 指明可以支持的高层协议，主要是 IP 协议，也可以是其他协议如：Novell IPX 和 AppleTalk
> - Data:46～1500 字节
> - CRC:循环冗余校验（帧校验序列），4 个字节。
>   - 接收方检测，如果有错，丢弃该帧
>
> ![截屏2023-06-26 17.17.52](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.17.52.png)

10、以太网提供服务

> ![截屏2023-06-26 17.19.08](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.19.08.png)

11.链路层交换机的工作原理（交换表的建立是通过自学习）

> - 链路层设备：
>
>   - 存储和转发以太网帧
>   - 检查帧头，并根据目的 MAC 地址有选择地转发帧
>   - 当 MAC 帧被转发到某一共享网段时，需要使用 CSMA/CD 访问该网段。
>
> - 即插即用，自学习
>
>   - 交换机不需要被配置
>
> - 过滤和转发的原理：
>
>   - 当交换机的接口 x 接收一数据帧时，
>
>   - ```Python
>     if 目的MAC地址 in 交换表:
>         if 目标MAC地址对应接口 == x:
>             丢弃该帧(过滤)     # 不将同一网段的的帧转发到其他网段
>         else:
>             转发到指定接口
>     else:
>         广播 
>     ```

12、路由器、交换机比较

> - 都是存储转发设备
>   - 路由器：网络层设备，转发分组
>   - 交换机：数据链路层设备，转发帧
> - 路由器实现路由算法建立路由表，并转发分组。网络层（IP）提供 TTL 等防止环路的措施。
> - 交换机实现自学习包含交换表、转发/过滤，但不提供对广播风暴（错误配置导致环路，广播帧不断增多）的保护。

13、路由器、交换机、集线器的区别

> ![截屏2023-06-26 17.26.38](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.26.38.png)

14、虚拟局域网

> （1）VLAN 的划分方法： 
>
> - 按照端口号划分 
> - 按照 MAC 地址划分 
> - 按照网络层地址划分(IPv4)
>
> （2）VLAN 的简单划分方式：
>
> ![截屏2023-06-26 17.33.13](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 17.33.13.png)



## 第五章练习题

> ![截屏2023-06-26 16.38.35](/Users/qinjianwu/Library/Application Support/typora-user-images/截屏2023-06-26 16.38.35.png)

> ![截屏2023-06-26 17.12.16](/Users/qinjianwu/Desktop/截屏2023-06-26 17.12.16.png)
